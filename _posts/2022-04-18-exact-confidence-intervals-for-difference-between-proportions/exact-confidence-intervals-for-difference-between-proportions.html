<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Exact confidence intervals for difference between proportions</title>

  <meta property="description" itemprop="description" content="This describes the ExactCIdiff package, unpacks the arguments to the functions, looks at timings and notes an oddity, a typo I think, in the original paper about the package."/>

  <link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"/>

  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-04-18"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-04-18"/>
  <meta name="article:author" content="Chris Evans"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Exact confidence intervals for difference between proportions"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="This describes the ExactCIdiff package, unpacks the arguments to the functions, looks at timings and notes an oddity, a typo I think, in the original paper about the package."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Exact confidence intervals for difference between proportions"/>
  <meta property="twitter:description" content="This describes the ExactCIdiff package, unpacks the arguments to the functions, looks at timings and notes an oddity, a typo I think, in the original paper about the package."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","output","creative_commons"]}},"value":[{"type":"character","attributes":{},"value":["Exact confidence intervals for difference between proportions"]},{"type":"character","attributes":{},"value":["This describes the ExactCIdiff package, unpacks the arguments to the functions, looks at timings and notes an oddity, a typo I think, in the original paper about the package.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Chris Evans"]},{"type":"character","attributes":{},"value":["https://www.psyctc.org/R_blog/"]},{"type":"character","attributes":{},"value":["PSYCTC.org"]},{"type":"character","attributes":{},"value":["https://www.psyctc.org/psyctc/"]},{"type":"character","attributes":{},"value":["0000-0002-4197-4202"]}]}]},{"type":"character","attributes":{},"value":["2022-04-18"]},{"type":"character","attributes":{},"value":["confidence intervals","proportions","exact confidence intervals"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth","hightlight_downlit","self_contained","code_folding"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[4]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["CC BY-SA"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["exact-confidence-intervals-for-difference-between-proportions_files/anchor-4.2.2/anchor.min.js","exact-confidence-intervals-for-difference-between-proportions_files/bowser-1.9.3/bowser.min.js","exact-confidence-intervals-for-difference-between-proportions_files/distill-2.2.21/template.v2.js","exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/separateIntervals2-1.png","exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/timingsPaired2-1.png","exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/timingsPaired3-1.png","exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/timingsUnpaired2-1.png","exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/timingsUnpaired3-1.png","exact-confidence-intervals-for-difference-between-proportions_files/header-attrs-2.24/header-attrs.js","exact-confidence-intervals-for-difference-between-proportions_files/jquery-3.6.0/jquery-3.6.0.js","exact-confidence-intervals-for-difference-between-proportions_files/jquery-3.6.0/jquery-3.6.0.min.js","exact-confidence-intervals-for-difference-between-proportions_files/jquery-3.6.0/jquery-3.6.0.min.map","exact-confidence-intervals-for-difference-between-proportions_files/kePrint-0.0.1/kePrint.js","exact-confidence-intervals-for-difference-between-proportions_files/lightable-0.0.1/lightable.css","exact-confidence-intervals-for-difference-between-proportions_files/popper-2.6.0/popper.min.js","exact-confidence-intervals-for-difference-between-proportions_files/tippy-6.2.7/tippy-bundle.umd.min.js","exact-confidence-intervals-for-difference-between-proportions_files/tippy-6.2.7/tippy-light-border.css","exact-confidence-intervals-for-difference-between-proportions_files/tippy-6.2.7/tippy.css","exact-confidence-intervals-for-difference-between-proportions_files/tippy-6.2.7/tippy.umd.min.js","exact-confidence-intervals-for-difference-between-proportions_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
    font-size: 100%;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  /* tweak for Pandoc numbered line within distill */
  d-article pre.numberSource code > span {
      left: -2em;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme, except when numbering line
    // in code chunk
    $('pre:not(.numberLines) code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        const citeChild = $(this).children()[0]
        // Do not process if @xyz has been used without escaping and without bibliography activated
        // https://github.com/rstudio/distill/issues/466
        if (citeChild === undefined) return true

        if (citeChild.nodeName == "D-FOOTNOTE") {
          var fn = citeChild
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          // Could use CSS.escape too here, we insure backward compatibility in navigator
          return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/header-attrs-2.24/header-attrs.js"></script>
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/kePrint-0.0.1/kePrint.js"></script>
  <link href="exact-confidence-intervals-for-difference-between-proportions_files/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/popper-2.6.0/popper.min.js"></script>
  <link href="exact-confidence-intervals-for-difference-between-proportions_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="exact-confidence-intervals-for-difference-between-proportions_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="exact-confidence-intervals-for-difference-between-proportions_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Exact confidence intervals for difference between proportions","description":"This describes the ExactCIdiff package, unpacks the arguments to the functions, looks at timings and notes an oddity, a typo I think, in the original paper about the package.","authors":[{"author":"Chris Evans","authorURL":"https://www.psyctc.org/R_blog/","affiliation":"PSYCTC.org","affiliationURL":"https://www.psyctc.org/psyctc/","orcidID":"0000-0002-4197-4202"}],"publishedDate":"2022-04-18T00:00:00.000+02:00","citationText":"Evans, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Exact confidence intervals for difference between proportions</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">confidence intervals</div>
<div class="dt-tag">proportions</div>
<div class="dt-tag">exact confidence intervals</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>This describes the ExactCIdiff package, unpacks the arguments to the functions, looks at timings and notes an oddity, a typo I think, in the original paper about the package.</p></p>
</div>

<div class="d-byline">
  Chris Evans <a href="https://www.psyctc.org/R_blog/" class="uri">https://www.psyctc.org/R_blog/</a> (PSYCTC.org)<a href="https://www.psyctc.org/psyctc/" class="uri">https://www.psyctc.org/psyctc/</a>
  
<br/>2022-04-18
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#back-to-the-story-background" id="toc-back-to-the-story-background">Back to the story: background</a></li>
<li><a href="#difference-between-proportions-in-two-separate-samples" id="toc-difference-between-proportions-in-two-separate-samples">Difference between proportions in two separate samples</a>
<ul>
<li><a href="#the-exact-ci-of-the-difference" id="toc-the-exact-ci-of-the-difference">The exact CI of the difference</a></li>
</ul></li>
<li><a href="#paired-difference-of-proportions" id="toc-paired-difference-of-proportions">Paired difference of proportions</a>
<ul>
<li><a href="#digression-about-tables-in-r-and-in-rmarkdown" id="toc-digression-about-tables-in-r-and-in-rmarkdown">Digression about tables in R and in Rmarkdown</a>
<ul>
<li><a href="#exact-ci-for-a-difference-between-paired-proportions" id="toc-exact-ci-for-a-difference-between-paired-proportions">Exact CI for a difference between paired proportions</a></li>
</ul></li>
</ul></li>
<li><a href="#computation-times" id="toc-computation-times">Computation times</a>
<ul>
<li><a href="#unpaired-example-cis-and-timings" id="toc-unpaired-example-cis-and-timings">Unpaired example: CIs and timings</a></li>
</ul></li>
<li><a href="#summary" id="toc-summary">Summary</a></li>
</ul>
</nav>
</div>
<p><strong>Warning: this is pretty geeky statistical stuff</strong></p>
<p><span style="color:red"><strong>Warning2: the package is no longer on CRAN</strong></span>
## <span style="color:red">Installing package from source</span></p>
<p><span style="color:red"><em>Update added 26.vi.22</em></span></p>
<p><span style="color:red">The ExactCIdiff package has dropped off CRAN because the authors/maintainers aren’t responding to the CRAN team and a URL in the package is not openning for CRAN. This doesn’t affect the code in the package.</span></p>
<p><span style="color:red">You can download the source package from <a href="https://cran.r-project.org/src/contrib/Archive/ExactCIdiff/" class="uri">https://cran.r-project.org/src/contrib/Archive/ExactCIdiff/</a>. It’s the last version, v1.3 you want which is <a href="https://cran.r-project.org/src/contrib/Archive/ExactCIdiff/ExactCIdiff_1.3.tar.gz" class="uri">https://cran.r-project.org/src/contrib/Archive/ExactCIdiff/ExactCIdiff_1.3.tar.gz</a></span></p>
<pre><code>### you can download it before launching R:
### install.packages(&quot;~/Downloads/ExactCIdiff_1.3.tar.gz&quot;, repos = NULL, type = &quot;source&quot;)
### replace &quot;~/Downloads/&quot; with the directory into which you downloaded it of course!

### or, as I should have remembered, you can omit downloading the package beforehand and just grab it withing the 
### install.packages() call:
install.packages(&quot;https://cran.r-project.org/src/contrib/Archive/ExactCIdiff/ExactCIdiff_1.3.tar.gz&quot;, repos = NULL, type = &quot;source&quot;)
</code></pre>
<p><span style="color:red">That’s that solved!</span></p>
<h2 id="back-to-the-story-background">Back to the story: background</h2>
<p>I came on this as Clara and I need to look at the differences in proportions between two arms of our “elephant” study (we call it that because it’s BIG!) I knew that I wasn’t confident about the best way to get 95% confidence intervals (CIs) for a difference between two proportions. I have been using Hmisc::binconf() for certainly over ten years for CIs around a single proportion but knew this was a bit different. A bit of searching led to the <a href="https://cran.r-project.org/web/packages/ExactCIdiff/index.html">ExactCIdiff package</a> and to the paper about it: <a href="https://journal.r-project.org/archive/2013/RJ-2013-026/index.html">Shan, G., &amp; Wang, W. (2013). ExactCIdiff: An R Package for Computing Exact Confidence Intervals for the Difference of Two Proportions. The R Journal, 5(2), 62. https://doi.org/10.32614/RJ-2013-026</a>.</p>
<p>I can’t follow the maths of the method but I do follow the evidence that it does better in terms of coverage probability (the actual probability that it will include the population value) than other methods. It’s a clean package and a nice paper and I say it’s a clean package as it appears to do just two things and the two things it sets out to do, and to do them well.</p>
<p>The two things are to give you a CI around an observed difference in proportions for a paired sample (e.g. proportion above a cut-off at baseline and after therapy) or for the same but for unconnected samples (what we have: students <em>versus</em> non-student people of the same age group).</p>
<p>I will start with the latter.</p>
<h2 id="difference-between-proportions-in-two-separate-samples">Difference between proportions in two separate samples</h2>
<p>I’ll quote from their paper:</p>
<blockquote>
<p>The second data set is from a two-arm randomized clinical trial for testing the effect of tobacco smoking on mice (Essenberg, 1952). In the treatment (smoking) group, the number of mice is n 1 = 23, and the number of mice which developed tumor is x = 21; in the control group, n 2 = 32 and y = 19.</p>
</blockquote>
<p>Ugh, not my world but it’s their paper. So here’s their data, rows as smoking/non-smoking groups and columns as whether the poor things developed tumours.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>smoking</span>, <span class='op'>~</span><span class='va'>tumour</span>, <span class='op'>~</span><span class='va'>n</span>,</span>
<span>        <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>21</span>,</span>
<span>        <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>2</span>,</span>
<span>        <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>19</span>,</span>
<span>        <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>13</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/uncount.html'>uncount</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>tibPoorMice</span></span>
<span></span>
<span><span class='va'>tibPoorMice</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/tabyl.html'>tabyl</a></span><span class='op'>(</span><span class='va'>smoking</span>, <span class='va'>tumour</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/adorn_totals.html'>adorn_totals</a></span><span class='op'>(</span>where <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"row"</span>, <span class='st'>"col"</span><span class='op'>)</span><span class='op'>)</span> </span></code></pre>
</div>
</details>
<pre><code> smoking  0  1 Total
       0 13 19    32
       1  2 21    23
   Total 15 40    55</code></pre>
</div>
<p>And with percentages.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>tibPoorMice</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/tabyl.html'>tabyl</a></span><span class='op'>(</span><span class='va'>smoking</span>, <span class='va'>tumour</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/adorn_totals.html'>adorn_totals</a></span><span class='op'>(</span>where <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"row"</span>, <span class='st'>"col"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/adorn_percentages.html'>adorn_percentages</a></span><span class='op'>(</span>denominator <span class='op'>=</span> <span class='st'>"row"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/adorn_pct_formatting.html'>adorn_pct_formatting</a></span><span class='op'>(</span>digits <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<pre><code> smoking     0     1  Total
       0 40.6% 59.4% 100.0%
       1  8.7% 91.3% 100.0%
   Total 27.3% 72.7% 100.0%</code></pre>
</div>
<p>Pretty clear that’s going to be statistically significant … and it is.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>tibPoorMice</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/tabyl.html'>tabyl</a></span><span class='op'>(</span><span class='va'>smoking</span>, <span class='va'>tumour</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/chisq.test.html'>chisq.test</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<pre><code>
    Pearson&#39;s Chi-squared test with Yates&#39; continuity correction

data:  .
X-squared = 5.3625, df = 1, p-value = 0.02057</code></pre>
</div>
<p>But what we want is the confidence interval. Here are the separate intervals.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>tibPoorMice</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>smoking</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='co'>### bit back to square one given I stared with the raw numbers but </span></span>
<span>  <span class='co'>### this is how it would be with real data</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>            nTumour <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>tumour</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>            <span class='co'>### this is a bit messy, Hmisc::binconf returns a matrix</span></span>
<span>            <span class='co'>### but I just want the first row, hence the "[1,]"</span></span>
<span>            <span class='co'>### and of course I need the list as that's how dplyr</span></span>
<span>            <span class='co'>### has to be told that what it's getting is a list or</span></span>
<span>            <span class='co'>### a vector (as here)</span></span>
<span>            binconf <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>Hmisc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/Hmisc/man/binconf.html'>binconf</a></span><span class='op'>(</span><span class='va'>nTumour</span>, <span class='va'>n</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='co'>### OK, unnest that</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/unnest_wider.html'>unnest_wider</a></span><span class='op'>(</span><span class='va'>binconf</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='co'>### recode smoking to a factor</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>smoking <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>ordered</a></span><span class='op'>(</span><span class='va'>smoking</span>,</span>
<span>                           levels <span class='op'>=</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>,</span>
<span>                           labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Smoked mice"</span>,</span>
<span>                                      <span class='st'>"Lucky ones"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>tmpTib</span> </span>
<span></span>
<span><span class='co'>### print that</span></span>
<span><span class='va'>tmpTib</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='co'>### do some rounding across the three values PointEst to Upper</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='va'>PointEst</span><span class='op'>:</span><span class='va'>Upper</span>, <span class='va'>round</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/pander/man/pander.html'>pander</a></span><span class='op'>(</span>justify <span class='op'>=</span> <span class='st'>"rrrrrr"</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<table style="width:78%;">
<colgroup>
<col style="width: 19%" />
<col style="width: 6%" />
<col style="width: 13%" />
<col style="width: 15%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">smoking</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">nTumour</th>
<th style="text-align: right;">PointEst</th>
<th style="text-align: right;">Lower</th>
<th style="text-align: right;">Upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Smoked mice</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.74</td>
</tr>
<tr class="even">
<td style="text-align: right;">Lucky ones</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.98</td>
</tr>
</tbody>
</table>
</div>
<p>And here as a plot as I am such a believer in offering both tabulated and plotted data where possible as some people find tables easier to digest (more precision) and others find the plots easier (more, hm, visual impact!)</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>### get overall proportion for reference line</span></span>
<span><span class='va'>tibPoorMice</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>nTumour <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>tumour</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>            n <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>            prop <span class='op'>=</span> <span class='va'>nTumour</span> <span class='op'>/</span> <span class='va'>n</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>prop</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>tmpAllProp</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>tmpTib</span>,</span>
<span>       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>smoking</span>, y <span class='op'>=</span> <span class='va'>PointEst</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_linerange</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>Lower</span>, ymax <span class='op'>=</span> <span class='va'>Upper</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='va'>tmpAllProp</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Proportion"</span>, breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>.1</span><span class='op'>)</span>, limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Whether the poor mice were smoked or not!"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"95% confidence intervals for proportions"</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<p><img src="exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/separateIntervals2-1.png" width="624" /></p>
</div>
<h3 id="the-exact-ci-of-the-difference">The exact CI of the difference</h3>
<p>So now (finally) we come to ExactCIdiff! The function is <code>BinomCI</code> and the syntax is that you give the four numbers from the crosstabulation, as n1, n2, count1, count2, so here 23, 32, 21, 19:</p>
<p><code>BinomCI(23, 32, 21, 19, conf.level = ?, CItype = ?)</code></p>
<p>I’m going to take things in the order that the authors do in their paper, starting with:</p>
<p><code>uci &lt;- BinomCI(23, 32, 21, 19, conf.level = 0.95, CItype = "Upper")$ExactCI</code> so the one-sided upper 95% confidence limit.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>uci</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff.html'>BinomCI</a></span><span class='op'>(</span><span class='fl'>23</span>, <span class='fl'>32</span>, <span class='fl'>21</span>, <span class='fl'>19</span>, conf.level <span class='op'>=</span> <span class='fl'>0.95</span>, CItype <span class='op'>=</span> <span class='st'>"Upper"</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>uci</span></span></code></pre>
</div>
</details>
<pre><code>[1] -1.00000  0.48595</code></pre>
</div>
<p>That’s a one-sided interval telling me that the upper 95% confidence limit for the difference is 0.48595: big. The computations are CPU intensive, that took 1 minutes on a fairly powerful laptop. I will generally want a two-sided interval and their next three calls to <code>BinomCI</code> demonstrate the relationship between the two one-sided 97.5% confidence limits and the two-sided CI. First the upper <em>97.5%</em> limit.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>u975</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff.html'>BinomCI</a></span><span class='op'>(</span><span class='fl'>23</span>, <span class='fl'>32</span>, <span class='fl'>21</span>, <span class='fl'>19</span>, conf.level <span class='op'>=</span> <span class='fl'>0.975</span>, CItype <span class='op'>=</span> <span class='st'>"Upper"</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>u975</span></span></code></pre>
</div>
</details>
<pre><code>[1] -1.00000  0.51259</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>elapsedTimeSecs2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</details>
</div>
<p>So upper <strong>97.5%</strong> limit 0.51259 (elapsed time 31.7 seconds).</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>l975</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff.html'>BinomCI</a></span><span class='op'>(</span><span class='fl'>23</span>, <span class='fl'>32</span>, <span class='fl'>21</span>, <span class='fl'>19</span>, conf.level <span class='op'>=</span> <span class='fl'>0.975</span>, CItype <span class='op'>=</span> <span class='st'>"Lower"</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>l975</span></span></code></pre>
</div>
</details>
<pre><code>[1] 0.09468 1.00000</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># [1] 0.09468 1.00000</span></span></code></pre>
</div>
</details>
</div>
<p>So lower <strong>97.5%</strong> limit 0.09468 (elapsed time 6.8 seconds).</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>ci95</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff.html'>BinomCI</a></span><span class='op'>(</span><span class='fl'>23</span>, <span class='fl'>32</span>, <span class='fl'>21</span>, <span class='fl'>19</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>ci95</span></span></code></pre>
</div>
</details>
<pre><code>[1] 0.09468 0.51259</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># [1] 0.09468 0.51259</span></span></code></pre>
</div>
</details>
</div>
<p>And it can be seen there that the two-sided 95% CI is from 0.09468 to 0.51259, i.e. from the lower <strong>97.5%</strong> CL to the upper <strong>97.5%</strong> CL. (Elapsed time
38.5 seconds).</p>
<h1 id="paired-difference-of-proportions">Paired difference of proportions</h1>
<p>Here again I’ll quote from the paper:</p>
<blockquote>
<p>We illustrate the usage of the PairedCI() function to calculate the exact smallest lower one-sided confidence interval [L<sub>P</sub> , 1] for θ<sub>P</sub> in (1) with the data from Karacan et al. (1976). In this study, 32 marijuana users are compared with 32 matched controls with respect to their sleeping difficulties, with n<sub>11</sub> = 16, n<sub>12</sub> = 9, n<sub>21</sub> = 3, and n<sub>22</sub> = 4. The second argument in the function is t = n<sub>11</sub> + n<sub>22</sub> = 20.</p>
</blockquote>
<p>The “(1)” refers back to the first equation in the paper which I won’t copy in here as it would need some formatting and doesn’t really matter for our purposes.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># ```{r makeTable, results='asis'}</span></span>
<span><span class='co'># tmpVec &lt;- c("", "Success at t2", "Failure at t2", "",</span></span>
<span><span class='co'>#             "Success at t1", "N11, p11", "N12, p12", "p1 = p11 + p12",</span></span>
<span><span class='co'>#             "Failure at t1", "N21, p21", "N22, p22", "",</span></span>
<span><span class='co'>#             "", "p2 = p11 + p21", "", "Total, p = 1")</span></span>
<span></span>
<span><span class='va'>tmpVec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>""</span>, <span class='st'>"Success at t2"</span>, <span class='st'>"Failure at t2"</span>, <span class='st'>""</span>,</span>
<span>            <span class='st'>"Success at t1"</span>, <span class='st'>"N11, p11"</span>, <span class='st'>"N12, p12"</span>, <span class='st'>""</span>,</span>
<span>            <span class='st'>"Failure at t1"</span>, <span class='st'>"N21, p21"</span>, <span class='st'>"N22, p22"</span>, <span class='st'>""</span>,</span>
<span>            <span class='st'>""</span>, <span class='st'>""</span>, <span class='st'>""</span>, <span class='st'>"Total, p = 1"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>tmpMat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>tmpVec</span>, ncol <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span><span class='co'># print(xtable::xtable(tmpMat, type = "html"))</span></span>
<span><span class='co'># print(xtable::xtable(tmpMat, getOption("xtable.type", "html")))</span></span>
<span><span class='co'># knitr::kable(tmpMat, "html")</span></span>
<span></span>
<span><span class='va'>tmpMat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kable_styling.html'>kable_styling</a></span><span class='op'>(</span>bootstrap_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"striped"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='co'># kable_styling() %&gt;%</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/row_spec.html'>row_spec</a></span><span class='op'>(</span><span class='fl'>1</span>, align <span class='op'>=</span> <span class='st'>"c"</span>, bold <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/row_spec.html'>row_spec</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>4</span>, align <span class='op'>=</span> <span class='st'>"c"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/column_spec.html'>column_spec</a></span><span class='op'>(</span><span class='fl'>1</span>, bold <span class='op'>=</span> <span class='cn'>TRUE</span>, border_right <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/column_spec.html'>column_spec</a></span><span class='op'>(</span><span class='fl'>2</span>, border_right <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/column_spec.html'>column_spec</a></span><span class='op'>(</span><span class='fl'>3</span>, border_right <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> </span></code></pre>
</div>
</details>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;text-align: center;font-weight: bold;border-right:1px solid;">
</td>
<td style="text-align:left;font-weight: bold;text-align: center;border-right:1px solid;">
Success at t1
</td>
<td style="text-align:left;font-weight: bold;text-align: center;border-right:1px solid;">
Failure at t1
</td>
<td style="text-align:left;font-weight: bold;text-align: center;">
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;font-weight: bold;border-right:1px solid;">
Success at t2
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
N11, p11
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
N21, p21
</td>
<td style="text-align:left;text-align: center;">
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;font-weight: bold;border-right:1px solid;">
Failure at t2
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
N12, p12
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
N22, p22
</td>
<td style="text-align:left;text-align: center;">
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;font-weight: bold;border-right:1px solid;">
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
</td>
<td style="text-align:left;text-align: center;">
Total, p = 1
</td>
</tr>
</tbody>
</table>
</div>
<p>I do find this way of describing a contingency table pretty counterinuitive!</p>
<h2 id="digression-about-tables-in-r-and-in-rmarkdown">Digression about tables in R and in Rmarkdown</h2>
<p><strong>GRRrrrr!!!</strong> <em>I continue to feel that table handling in R is almost its Achilles heel. I’ve just wasted the better part of an hour finding out a way to get that table in an even halfway, no quarterway, decent form. I think I first commented on this perhaps twenty years ago and the R team position has always been, I think, that nice tables are for packages to fix and so we have multiple packages that try to fix this, mostly incompatible and none of them working reliably in Rmarkdown and with all output formats from Rmarkdown. I think the R afficionados all love knocking up tables in LaTeX and I’m sure that’s fine if you are really familiar with LaTeX and I suspect that direct R to LaTeX is the most robust and general way to do things but many of us don’t know TeX/LaTeX and don’t really want to have to learn it.</em> <strong>Aarghhhh!</strong> OK, flame over!</p>
<p>Back to the data here.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>tmpVec2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>""</span>, <span class='st'>"Sleep OK, no smokes"</span>, <span class='st'>"Sleep poor, no smokes"</span>, <span class='st'>""</span>,</span>
<span>            <span class='st'>"Sleep OK, smokes"</span>, <span class='st'>"16"</span>, <span class='st'>"9"</span>, <span class='st'>""</span>,</span>
<span>            <span class='st'>"Sleep poor, smokes"</span>, <span class='st'>"3"</span>, <span class='st'>"4"</span>, <span class='st'>""</span>,</span>
<span>            <span class='st'>""</span>, <span class='st'>""</span>, <span class='st'>""</span>, <span class='st'>"Total, p = 1"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>tmpMat2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>tmpVec2</span>, ncol <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span><span class='co'># print(xtable::xtable(tmpMat, type = "html"))</span></span>
<span><span class='co'># print(xtable::xtable(tmpMat, getOption("xtable.type", "html")))</span></span>
<span><span class='co'># knitr::kable(tmpMat, "html")</span></span>
<span></span>
<span><span class='va'>tmpMat2</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kable_styling.html'>kable_styling</a></span><span class='op'>(</span>bootstrap_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"striped"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='co'># kable_styling() %&gt;%</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/row_spec.html'>row_spec</a></span><span class='op'>(</span><span class='fl'>1</span>, align <span class='op'>=</span> <span class='st'>"c"</span>, bold <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/row_spec.html'>row_spec</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>4</span>, align <span class='op'>=</span> <span class='st'>"c"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/column_spec.html'>column_spec</a></span><span class='op'>(</span><span class='fl'>1</span>, bold <span class='op'>=</span> <span class='cn'>TRUE</span>, border_right <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/column_spec.html'>column_spec</a></span><span class='op'>(</span><span class='fl'>2</span>, border_right <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/column_spec.html'>column_spec</a></span><span class='op'>(</span><span class='fl'>3</span>, border_right <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> </span></code></pre>
</div>
</details>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;text-align: center;font-weight: bold;border-right:1px solid;">
</td>
<td style="text-align:left;font-weight: bold;text-align: center;border-right:1px solid;">
Sleep OK, smokes
</td>
<td style="text-align:left;font-weight: bold;text-align: center;border-right:1px solid;">
Sleep poor, smokes
</td>
<td style="text-align:left;font-weight: bold;text-align: center;">
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;font-weight: bold;border-right:1px solid;">
Sleep OK, no smokes
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
16
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
3
</td>
<td style="text-align:left;text-align: center;">
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;font-weight: bold;border-right:1px solid;">
Sleep poor, no smokes
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
9
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
4
</td>
<td style="text-align:left;text-align: center;">
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;font-weight: bold;border-right:1px solid;">
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
</td>
<td style="text-align:left;text-align: center;border-right:1px solid;">
</td>
<td style="text-align:left;text-align: center;">
Total, p = 1
</td>
</tr>
</tbody>
</table>
</div>
<h3 id="exact-ci-for-a-difference-between-paired-proportions">Exact CI for a difference between paired proportions</h3>
<p>That means that the code is:</p>
<p><code>PairedCI(9, 20, 3, conf.level = 0.95)</code></p>
<p>because the syntax is</p>
<p><code>PairedCI(n12, t, n21, conf.level, CItype, precision, grid.one, grid.two)</code></p>
<p>where we can ignore grid.one and grid.two for now and leave them at their default values of 30 and 20 and precision is, as the help says:</p>
<p><em>Precision of the confidence interval, default is 0.00001 rounded to 5 decimals.</em></p>
<p>OK, so here we go with:</p>
<p><code>PairedCI(9, 20, 3, conf.level = 0.95)</code></p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>lciall</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff1.html'>PairedCI</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>20</span>, <span class='fl'>3</span>, conf.level <span class='op'>=</span> <span class='fl'>0.95</span><span class='op'>)</span> <span class='co'># store relevant quantities</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>lciall</span></span></code></pre>
</div>
</details>
<pre><code>$conf.level
[1] 0.95

$CItype
[1] &quot;Two.sided&quot;

$estimate
[1] 0.1875

$ExactCI
[1] -0.03564  0.39521</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># $conf.level</span></span>
<span><span class='co'># [1] 0.95</span></span>
<span><span class='co'># </span></span>
<span><span class='co'># $CItype</span></span>
<span><span class='co'># [1] "Two.sided"</span></span>
<span><span class='co'># </span></span>
<span><span class='co'># $estimate</span></span>
<span><span class='co'># [1] 0.1875</span></span>
<span><span class='co'># </span></span>
<span><span class='co'># $ExactCI</span></span>
<span><span class='co'># [1] -0.03564  0.39521</span></span></code></pre>
</div>
</details>
</div>
<p>(Elapsed time
15.8 seconds.)</p>
<p>The odd thing here is that this is not what the authors show in the paper:</p>
<pre><code>lciall  # print lciall  
$conf.level  
[1] 0.95    # confidence level  
$CItype  
[1] &quot;Lower&quot; # lower one-sided interval    
$estimate  
[1] 0.1875  # the mle of p1 - p2  
$ExactCI 
[1] 0.00613 1.00000 # the lower one-sided 95% interval  
lci &lt;- lciall$ExactCI # extracting the lower one-sided 95% interval  
lci         # print lci  
[1] 0.00613 1.00000  </code></pre>
<blockquote>
<p>The use of marijuana helps sleeping because the interval [ 0.00613, 1 ] for θ<sub>P</sub> is positive.</p>
</blockquote>
<p>Which is clearly <em>not</em> what I just got. However, in the paper they go on:</p>
<pre><code>The upper one-sided 95% interval and the two-sided 95% interval for θ~P~ are given below for illustration purpose.</code></pre>
<p>I think that’s a typo. I think what they are showing are the results of</p>
<p><code>PairedCI(9, 20, 3, conf.level = 0.95, CItype = "lower")</code></p>
<p>Let’s see:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>lciall</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff1.html'>PairedCI</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>20</span>, <span class='fl'>3</span>, conf.level <span class='op'>=</span> <span class='fl'>0.95</span>, CItype <span class='op'>=</span> <span class='st'>"Lower"</span><span class='op'>)</span> <span class='co'># store relevant quantities</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>lciall</span></span></code></pre>
</div>
</details>
<pre><code>$conf.level
[1] 0.95

$CItype
[1] &quot;Lower&quot;

$estimate
[1] 0.1875

$ExactCI
[1] 0.00613 1.00000</code></pre>
</div>
<p>Yes! (Elapsed time
3.5 seconds.)</p>
<p>They do go on to give us other things in the paper and that I think confirms that the above call was a typo.</p>
<p>So here is the upper 95% CL.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>uci</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff1.html'>PairedCI</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>20</span>, <span class='fl'>3</span>, conf.level <span class='op'>=</span> <span class='fl'>0.95</span>, CItype <span class='op'>=</span> <span class='st'>"Upper"</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs7</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>uci</span></span></code></pre>
</div>
</details>
<pre><code>[1] -1.00000  0.36234</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># [1] -1.00000  0.36234</span></span></code></pre>
</div>
</details>
</div>
<p>(Elapsed time
12.5 seconds.)</p>
<p>The upper <strong>97.5%</strong> CL.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>u975</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff1.html'>PairedCI</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>20</span>, <span class='fl'>3</span>, conf.level <span class='op'>=</span> <span class='fl'>0.975</span>, CItype <span class='op'>=</span> <span class='st'>"Upper"</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs8</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>u975</span></span></code></pre>
</div>
</details>
<pre><code>[1] -1.00000  0.39521</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># [1] -1.00000  0.39521</span></span></code></pre>
</div>
</details>
</div>
<p>(Elapsed time
12.2 seconds.)</p>
<p>The lower <strong>97.5%</strong> CL.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>l975</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff1.html'>PairedCI</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>20</span>, <span class='fl'>3</span>, conf.level <span class='op'>=</span> <span class='fl'>0.975</span>, CItype <span class='op'>=</span> <span class='st'>"Lower"</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs9</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>l975</span></span></code></pre>
</div>
</details>
<pre><code>[1] -0.03564  1.00000</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># [1] -0.03564  1.00000</span></span></code></pre>
</div>
</details>
</div>
<p>(Elapsed time
3.4 seconds.)</p>
<p>And back to the two-sided 95% CI (and yes, I’m running it again just to be sure I get the same answer as last time!)</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span><span class='va'>ci95</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff1.html'>PairedCI</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>20</span>, <span class='fl'>3</span>, conf.level <span class='op'>=</span> <span class='fl'>0.95</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span><span class='va'>elapsedTimeSecs10</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>ci95</span></span></code></pre>
</div>
</details>
<pre><code>[1] -0.03564  0.39521</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># [1] -0.03564  0.39521</span></span></code></pre>
</div>
</details>
</div>
<p>(Elapsed time
15.6 seconds.)</p>
<p>Yup, the same again and fits with what they say in the paper:</p>
<pre><code>[1] -0.03564 0.39521 # the two-sided 95% interval
                      # it is equal to the intersection of two one-sided intervals</code></pre>
<h1 id="computation-times">Computation times</h1>
<p>Clearly one issue here is that these are small total sample sizes in their two examples but the process is computationally expensive (though 40x faster than another approach with the same accuracy/coverage).</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>vecMultipliers</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span> <span class='co'># check for sample sizes 1 to 8x the example above</span></span>
<span><span class='va'>vecTimesPaired</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>vecMultipliers</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>matCI95paired</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>vecMultipliers</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>2</span><span class='op'>)</span>, ncol <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>vecTimesPaired</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>elapsedTimeSecs10</span></span>
<span><span class='va'>matCI95paired</span><span class='op'>[</span><span class='fl'>1</span>, <span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>ci95</span></span>
<span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>mult</span> <span class='kw'>in</span> <span class='va'>vecMultipliers</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span>  <span class='va'>matCI95paired</span><span class='op'>[</span><span class='va'>mult</span>, <span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff1.html'>PairedCI</a></span><span class='op'>(</span><span class='va'>mult</span> <span class='op'>*</span> <span class='fl'>9</span>, <span class='va'>mult</span> <span class='op'>*</span> <span class='fl'>20</span>, <span class='va'>mult</span> <span class='op'>*</span> <span class='fl'>3</span>, conf.level <span class='op'>=</span> <span class='fl'>0.95</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span>  <span class='va'>vecTimesPaired</span><span class='op'>[</span><span class='va'>mult</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</details>
</div>
<p>Here are those CIs getting tighter as the numbers go up.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>matCI95paired</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols</a></span><span class='op'>(</span><span class='va'>vecMultipliers</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>nPairs <span class='op'>=</span> <span class='va'>`...3`</span>,</span>
<span>         LCL <span class='op'>=</span> <span class='va'>V1</span>,</span>
<span>         UCL <span class='op'>=</span> <span class='va'>V2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>nPairs <span class='op'>=</span> <span class='fl'>32</span> <span class='op'>*</span> <span class='va'>nPairs</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>nPairs</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>tibCI95paired</span></span>
<span></span>
<span><span class='va'>tibCI95paired</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'>pander</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pander/man/pander.html'>pander</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<table style="width:43%;">
<colgroup>
<col style="width: 12%" />
<col style="width: 15%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">nPairs</th>
<th style="text-align: center;">LCL</th>
<th style="text-align: center;">UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">32</td>
<td style="text-align: center;">-0.03564</td>
<td style="text-align: center;">0.3952</td>
</tr>
<tr class="even">
<td style="text-align: center;">64</td>
<td style="text-align: center;">0.03751</td>
<td style="text-align: center;">0.3396</td>
</tr>
<tr class="odd">
<td style="text-align: center;">96</td>
<td style="text-align: center;">0.06301</td>
<td style="text-align: center;">0.3067</td>
</tr>
<tr class="even">
<td style="text-align: center;">128</td>
<td style="text-align: center;">0.07231</td>
<td style="text-align: center;">0.2906</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>tibCI95paired</span>,</span>
<span>       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>nPairs</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_linerange</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>LCL</span>, ymax <span class='op'>=</span> <span class='va'>UCL</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>0.1875</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Difference in proportions"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Number of pairs"</span>,</span>
<span>                     breaks <span class='op'>=</span> <span class='va'>vecMultipliers</span> <span class='op'>*</span> <span class='fl'>32</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Two sided 95% CI tightening with increasing sample size"</span>,</span>
<span>          subtitle <span class='op'>=</span> <span class='st'>"Horizontal reference line is observed difference in proportions"</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<p><img src="exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/timingsPaired2-1.png" width="624" /></p>
</div>
<p>And here are the times (in seconds).</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='va'>vecTimesPaired</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>timeSecs <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols</a></span><span class='op'>(</span><span class='va'>vecMultipliers</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>nPairs <span class='op'>=</span> <span class='va'>`...2`</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>nPairs <span class='op'>=</span> <span class='fl'>32</span> <span class='op'>*</span> <span class='va'>nPairs</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>nPairs</span>, <span class='va'>timeSecs</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>tibTimesPaired</span></span>
<span></span>
<span><span class='va'>tibTimesPaired</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/pander/man/pander.html'>pander</a></span><span class='op'>(</span>justify <span class='op'>=</span> <span class='st'>"rr"</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<table style="width:28%;">
<colgroup>
<col style="width: 12%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">nPairs</th>
<th style="text-align: right;">timeSecs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">32</td>
<td style="text-align: right;">15.63</td>
</tr>
<tr class="even">
<td style="text-align: right;">64</td>
<td style="text-align: right;">167.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">96</td>
<td style="text-align: right;">243.8</td>
</tr>
<tr class="even">
<td style="text-align: right;">128</td>
<td style="text-align: right;">550.7</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>tibTimesPaired</span>,</span>
<span>       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>nPairs</span>, y <span class='op'>=</span> <span class='va'>timeSecs</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Elapsed time (seconds)"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Number of pairs of participants"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Plot of computation time against sample size"</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<p><img src="exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/timingsPaired3-1.png" width="624" /></p>
</div>
<p>Hm. That doesn’t look that far off linear which is not what I had expected.</p>
<h3 id="unpaired-example-cis-and-timings">Unpaired example: CIs and timings</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>ci95</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff.html'>BinomCI</a></span><span class='op'>(</span><span class='fl'>23</span>, <span class='fl'>32</span>, <span class='fl'>21</span>, <span class='fl'>19</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span></span>
<span><span class='va'>vecTimesUnpaired</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>vecMultipliers</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>matCI95unpaired</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>vecMultipliers</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>2</span><span class='op'>)</span>, ncol <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>mult</span> <span class='kw'>in</span> <span class='va'>vecMultipliers</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time1</span></span>
<span>  <span class='va'>matCI95unpaired</span><span class='op'>[</span><span class='va'>mult</span>, <span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ExactCIdiff/man/ExactCIdiff1.html'>PairedCI</a></span><span class='op'>(</span><span class='va'>mult</span> <span class='op'>*</span> <span class='fl'>9</span>, <span class='va'>mult</span> <span class='op'>*</span> <span class='fl'>20</span>, <span class='va'>mult</span> <span class='op'>*</span> <span class='fl'>3</span>, conf.level <span class='op'>=</span> <span class='fl'>0.95</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ExactCI</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>time2</span></span>
<span>  <span class='va'>vecTimesUnpaired</span><span class='op'>[</span><span class='va'>mult</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='va'>time2</span>, <span class='va'>time1</span>, units <span class='op'>=</span> <span class='st'>"secs"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>matCI95unpaired</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols</a></span><span class='op'>(</span><span class='va'>vecMultipliers</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>nTotal <span class='op'>=</span> <span class='va'>`...3`</span>,</span>
<span>         LCL <span class='op'>=</span> <span class='va'>V1</span>,</span>
<span>         UCL <span class='op'>=</span> <span class='va'>V2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>nTotal <span class='op'>=</span> <span class='fl'>55</span> <span class='op'>*</span> <span class='va'>nTotal</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>nTotal</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>tibCI95unpaired</span></span>
<span></span>
<span><span class='va'>tibCI95unpaired</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'>pander</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pander/man/pander.html'>pander</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<table style="width:43%;">
<colgroup>
<col style="width: 12%" />
<col style="width: 15%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">nTotal</th>
<th style="text-align: center;">LCL</th>
<th style="text-align: center;">UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">55</td>
<td style="text-align: center;">-0.03564</td>
<td style="text-align: center;">0.3952</td>
</tr>
<tr class="even">
<td style="text-align: center;">110</td>
<td style="text-align: center;">0.03751</td>
<td style="text-align: center;">0.3396</td>
</tr>
<tr class="odd">
<td style="text-align: center;">165</td>
<td style="text-align: center;">0.06301</td>
<td style="text-align: center;">0.3067</td>
</tr>
<tr class="even">
<td style="text-align: center;">220</td>
<td style="text-align: center;">0.07231</td>
<td style="text-align: center;">0.2906</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>tibCI95unpaired</span>,</span>
<span>       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>nTotal</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_linerange</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>LCL</span>, ymax <span class='op'>=</span> <span class='va'>UCL</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>0.1875</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Difference in proportions"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Total number of mice"</span>,</span>
<span>                     breaks <span class='op'>=</span> <span class='va'>vecMultipliers</span> <span class='op'>*</span> <span class='fl'>32</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Two sided 95% CI tightening with increasing sample size"</span>,</span>
<span>          subtitle <span class='op'>=</span> <span class='st'>"Horizontal reference line is observed difference in proportions"</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<p><img src="exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/timingsUnpaired2-1.png" width="624" /></p>
</div>
<p>And, again, the times.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='va'>vecTimesUnpaired</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>timeSecs <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols</a></span><span class='op'>(</span><span class='va'>vecMultipliers</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>nTotal <span class='op'>=</span> <span class='va'>`...2`</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>nTotal <span class='op'>=</span> <span class='fl'>32</span> <span class='op'>*</span> <span class='va'>nTotal</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>nTotal</span>, <span class='va'>timeSecs</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>tibTimesPaired</span></span>
<span></span>
<span><span class='va'>tibTimesPaired</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/pander/man/pander.html'>pander</a></span><span class='op'>(</span>justify <span class='op'>=</span> <span class='st'>"rr"</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<table style="width:28%;">
<colgroup>
<col style="width: 12%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">nTotal</th>
<th style="text-align: right;">timeSecs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">32</td>
<td style="text-align: right;">15.46</td>
</tr>
<tr class="even">
<td style="text-align: right;">64</td>
<td style="text-align: right;">170.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">96</td>
<td style="text-align: right;">244.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">128</td>
<td style="text-align: right;">545.6</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>tibTimesPaired</span>,</span>
<span>       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>nTotal</span>, y <span class='op'>=</span> <span class='va'>timeSecs</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Elapsed time (seconds)"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Number of mice"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Plot of computation time against sample size"</span><span class='op'>)</span></span></code></pre>
</div>
</details>
<p><img src="exact-confidence-intervals-for-difference-between-proportions_files/figure-html5/timingsUnpaired3-1.png" width="624" /></p>
</div>
<p>Again, looks fairly linear. Interesting.</p>
<h1 id="summary">Summary</h1>
<p>The R package ExactCIdiff provides two functions which give what appear to be the best confidence intervals for differences between two proportions, one function, <code>BinomCI()</code> for differences from unpaired samples and the other <code>PairedCI()</code> for paired samples. I think there’s a typo in the paper about the package and the syntax of the arguments isn’t particularly friendly (it’s even case sensitive so <code>CItype = "upper"</code> with throw an error, it has to be <code>CItype = "Upper"</code>). However, it’s not difficult to work those things out (and that’s partly why I’ve created this post) and it does seem that these really are the best ways to get these CIs. They’re faily computationally intensive but from my tiny simulation it looks as if the timing is linear across simple multiples of sample size. Thanks and kudos to Shan and Wang!</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
